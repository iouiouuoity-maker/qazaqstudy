<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ ‚Ä¢ 7‚Äì8</title>

  <style>
    :root{
      --bg:#f6f8ff;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --p:#2563eb;
      --p2:#3b82f6;
      --soft:#eef2ff;
      --okbg: rgba(34,197,94,.12);
      --okline: rgba(34,197,94,.35);
      --shadow: 0 18px 40px rgba(15,23,42,.10);
      --r: 22px;
      --focus:#f59e0b;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background: radial-gradient(900px 520px at 12% 0%, #dbeafe 0%, var(--bg) 45%, #ffffff 100%);
    }
    .wrap{max-width:1180px;margin:0 auto;padding:14px}
    .panel{padding:4px}

    /* header */
    .top{
      position:sticky;top:0;z-index:10;
      background: rgba(246,248,255,.92);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--line);
      padding:12px 14px;
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
    }
    .brand{display:flex;gap:10px;align-items:center;text-decoration:none;color:inherit;cursor:pointer}
    .mark{
      width:44px;height:44px;border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg, var(--p2), #22c55e);
      color:#fff;font-weight:900;
      box-shadow: 0 10px 24px rgba(59,130,246,.22);
      user-select:none;
    }
    .b1{font-weight:900}
    .b2{color:var(--muted);font-weight:700;font-size:12px}

    .nav{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .sep{width:1px;height:34px;background:var(--line)}
    .navbtn{
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      padding:10px 14px;border-radius:999px;
      font-weight:900;text-decoration:none;color:inherit;
      box-shadow: 0 10px 24px rgba(15,23,42,.05);
      cursor:pointer;
    }
    .navbtn.is-on{
      border-color:transparent;
      background: linear-gradient(180deg, var(--p2), var(--p));
      color:#fff;
    }
    .iconbtn{
      width:46px;height:46px;border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      font-weight:900;cursor:pointer;
      user-select:none;
    }
    .iconbtn.is-on{
      border-color:transparent;
      background: linear-gradient(180deg, var(--p2), var(--p));
      color:#fff;
    }

    /* home */
    .filters{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .seg{
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      border-radius:999px;padding:6px;
      display:flex;gap:6px;flex-wrap:wrap;
      box-shadow: 0 10px 24px rgba(15,23,42,.05);
    }
    .segbtn{
      border:0;background:transparent;
      padding:10px 12px;border-radius:999px;
      font-weight:900;cursor:pointer;
    }
    .segbtn.is-on{
      background: linear-gradient(180deg, var(--p2), var(--p));
      color:#fff;
    }

    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }

    .tile{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
      cursor:pointer;
      transition: transform .08s ease, box-shadow .08s ease;
    }
    .tile:hover{transform: translateY(-1px)}
    .tMeta{display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      border:1px solid var(--line);
      background:var(--soft);
      padding:8px 10px;border-radius:999px;
      font-weight:900;font-size:12px;
    }
    .tTitle{margin-top:10px;font-weight:900;font-size:18px}
    .tSub{margin-top:6px;color:var(--muted);font-weight:700;font-size:12px}

    /* pages */
    .page{display:none}
    .page.is-on{display:block}

    /* lesson */
    .lessonTop{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
    .back{
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      padding:10px 14px;border-radius:999px;
      font-weight:900;
      cursor:pointer;
    }
    .lessonNav{display:flex;gap:10px}
    .navmini{
      width:52px;height:52px;border-radius:18px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.80);
      font-weight:900;cursor:pointer;
    }
    .h1{margin:12px 0 0;font-size:28px}

    .two{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 980px){ .two{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .card.big{padding:16px}
    .cardTitle{font-weight:900;margin-bottom:10px}
    .row{margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .hint{margin-top:10px;color:var(--muted);font-weight:700;font-size:12px}

    .btn{
      border:0;
      background: linear-gradient(180deg, var(--p2), var(--p));
      color:#fff;
      padding:12px 14px;border-radius:16px;
      font-weight:900;cursor:pointer;
    }
    .btn.ghost{
      background:transparent;
      border:1px solid var(--line);
      color:var(--text);
    }
    .inp{
      flex:1;min-width:200px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.85);
      padding:12px 12px;border-radius:16px;
      font-weight:900;
    }

    .text{display:grid;gap:10px}
    .line{
      border:1px solid var(--line);
      border-radius:18px;padding:12px;
      background: rgba(59,130,246,.06);
      display:flex;gap:12px;align-items:flex-start;
      cursor:pointer;
    }
    .badge{
      width:38px;height:38px;border-radius:14px;
      display:flex;align-items:center;justify-content:center;
      background:#fff;border:1px solid var(--line);
      font-weight:900;
      user-select:none;
    }
    .k{margin:0;font-size:18px;font-weight:900}
    .r{margin:6px 0 0;color:var(--muted);font-weight:800}

    .quiz{display:grid;gap:10px}
    .qrow{border:1px solid var(--line);border-radius:18px;padding:12px;background: rgba(15,23,42,.02)}
    .qt{font-weight:900}
    .pills{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .pillbtn{border:1px solid var(--line);background:#fff;padding:10px 12px;border-radius:999px;font-weight:900;cursor:pointer}
    .pillbtn.ok{background: var(--okbg); border-color: var(--okline)}

    .pick{display:grid;gap:10px}
    .abtn{border:1px solid var(--line);background:#fff;padding:14px 12px;border-radius:18px;font-weight:900;cursor:pointer}
    .abtn.ok{background: var(--okbg); border-color: var(--okline)}

    .bank{display:flex;gap:8px;flex-wrap:wrap}
    .wbtn{border:1px solid var(--line);background:#fff;padding:10px 12px;border-radius:999px;font-weight:900;cursor:pointer}
    .out{margin-top:10px;min-height:44px;border:1px solid var(--line);border-radius:18px;padding:12px;background: rgba(15,23,42,.02);font-weight:900;font-size:20px}

    .comicCard{border:1px solid var(--line);border-radius:18px;padding:12px;background: rgba(34,197,94,.06);display:flex;justify-content:space-between;gap:10px;align-items:center}
    .comicName{font-weight:900}
    .comicList{margin-top:10px;display:grid;gap:10px}
    .comRow{border:1px solid var(--line);border-radius:18px;padding:12px;background: rgba(255,255,255,.85);display:flex;justify-content:space-between;gap:10px;align-items:center}
    .comT{font-weight:900}

    .words{margin-top:12px;display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media (max-width: 980px){ .words{grid-template-columns:1fr} }
    .wi{border:1px solid var(--line);border-radius:18px;padding:12px;background: rgba(59,130,246,.04);display:flex;justify-content:space-between;gap:10px;align-items:center}
    .wkk{font-weight:900;font-size:18px}
    .wru{color:var(--muted);font-weight:800}
    .wiBtn{border:1px solid var(--line);background:#fff;border-radius:14px;padding:10px 12px;font-weight:900;cursor:pointer}

    .aiBox{margin-top:12px;border:1px solid var(--line);border-radius:var(--r);padding:14px;background: rgba(59,130,246,.04);min-height:560px}

    :focus-visible{outline:3px solid var(--focus);outline-offset:3px;border-radius:14px}
    body.big{font-size:20px}
    body.contrast{
      --bg:#ffffff; --card:#ffffff; --text:#000000; --muted:#111111;
      --line:#000000; --p:#000000; --p2:#000000; --soft:#ffffff; --shadow:none;
    }
  </style>
</head>

<body>
<header class="top">
  <div class="brand" id="goHome" tabindex="0">
    <div class="mark">“ö–¢</div>
    <div>
      <div class="b1">“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ ‚Ä¢ 7‚Äì8</div>
      <div class="b2">–¢–µ–º—ã ‚Ä¢ –ó–∞–¥–∞–Ω–∏—è ‚Ä¢ –ö–æ–º–∏–∫—Å</div>
    </div>
  </div>

  <div class="nav">
    <div class="navbtn is-on" id="navHome" role="button" tabindex="0">–¢–µ–º—ã</div>
    <div class="navbtn" id="navAssistant" role="button" tabindex="0">–ü–æ–º–æ—â–Ω–∏–∫</div>
    <span class="sep"></span>
    <button class="iconbtn" id="btnContrast" type="button" title="–ö–æ–Ω—Ç—Ä–∞—Å—Ç">‚óê</button>
    <button class="iconbtn" id="btnFont" type="button" title="–ö—Ä—É–ø–Ω—ã–π —Ç–µ–∫—Å—Ç">A+</button>
    <button class="iconbtn is-on" id="btnSound" type="button" title="–û–∑–≤—É—á–∫–∞">üîä</button>
  </div>
</header>

<main class="wrap">

  <section class="page is-on" id="page-home">
    <div class="panel">
      <div class="filters">
        <div class="seg">
          <button class="segbtn is-on" data-grade="all" type="button">7‚Äì8</button>
          <button class="segbtn" data-grade="7" type="button">7</button>
          <button class="segbtn" data-grade="8" type="button">8</button>
        </div>
      </div>

      <div class="grid" id="topicGrid"></div>
    </div>
  </section>

  <section class="page" id="page-lesson">
    <div class="panel">
      <div class="lessonTop">
        <button class="back" id="backHome" type="button">‚Üê –¢–µ–º—ã</button>

        <div class="tMeta">
          <span class="chip" id="chipGrade">‚Äî</span>
          <span class="chip" id="chipTopic">‚Äî</span>
        </div>

        <div class="lessonNav">
          <button class="navmini" id="btnPrev" type="button">‚óÄ</button>
          <button class="navmini" id="btnNext" type="button">‚ñ∂</button>
        </div>
      </div>

      <h1 class="h1" id="lessonTitle">‚Äî</h1>

      <div class="two">
        <div class="card">
          <div class="cardTitle">–¢–µ–∫—Å—Ç</div>
          <div class="text" id="lessonText"></div>
          <div class="row">
            <button class="btn ghost" id="btnReadAll" type="button">–ü—Ä–æ—á–∏—Ç–∞—Ç—å</button>
            <button class="btn ghost" id="btnStop" type="button">–°—Ç–æ–ø</button>
          </div>
          <div class="hint" id="speechHint"></div>
        </div>

        <div class="card">
          <div class="cardTitle">–ö–æ–º–∏–∫—Å</div>
          <div class="comicCard">
            <div>
              <div class="comicName" id="comicName">‚Äî</div>
              <div class="hint">–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ</div>
            </div>
            <button class="btn" id="btnOpenComic" type="button">–û—Ç–∫—Ä—ã—Ç—å</button>
          </div>

          <div class="comicList" id="comicList"></div>
        </div>
      </div>

      <div class="two">
        <div class="card">
          <div class="cardTitle">–ü–æ–Ω–∏–º–∞–Ω–∏–µ</div>
          <div class="quiz" id="quiz"></div>
        </div>

        <div class="card">
          <div class="cardTitle">–í—ã–±–µ—Ä–∏</div>
          <div class="pick" id="pick"></div>
          <div class="row">
            <button class="btn ghost" id="btnPickNew" type="button">–û–±–Ω–æ–≤–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <div class="two">
        <div class="card">
          <div class="cardTitle">–°–æ–±–µ—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</div>
          <div class="bank" id="bank"></div>
          <div class="out" id="out"></div>
          <div class="row">
            <button class="btn" id="btnSayLine" type="button">–û–∑–≤—É—á–∏—Ç—å</button>
            <button class="btn ghost" id="btnClearLine" type="button">–û—á–∏—Å—Ç–∏—Ç—å</button>
          </div>
        </div>

        <div class="card">
          <div class="cardTitle">–°–ª–æ–≤–∞—Ä—å</div>
          <div class="row">
            <input class="inp" id="wordSearch" placeholder="–ü–æ–∏—Å–∫‚Ä¶" />
            <button class="btn ghost" id="btnWordNext" type="button">–î–∞–ª–µ–µ —á–∏—Ç–∞—Ç—å</button>
          </div>
          <div class="words" id="words"></div>
        </div>
      </div>

    </div>
  </section>

  <section class="page" id="page-assistant">
    <div class="panel">
      <div class="card big">
        <div class="cardTitle">–ü–æ–º–æ—â–Ω–∏–∫</div>

        <div class="aiBox">
          <!-- Elfsight AI Chatbot | Untitled AI Chatbot -->
          <script src="https://elfsightcdn.com/platform.js" async></script>
          <div class="elfsight-app-5f869929-6809-4ce9-a5e5-0c39be8285c4" data-elfsight-app-lazy></div>
        </div>
      </div>
    </div>
  </section>

</main>

<script>
  const $ = (s) => document.querySelector(s);
  const $$ = (s) => [...document.querySelectorAll(s)];

  const STATE = {
    grade: "all",
    sound: true,
    lessonId: null,
    readTimer: null,
    currentComic: "https://qazcomics.kz/kz/comics/5/2",
    wordIndex: 0,
  };

  const COMICS = [
    { t: "QazComics", url: "https://qazcomics.kz/kz" },
    { t: "–ï—Ä –¢–∞—Ä“ì—ã–Ω 1", url: "https://qazcomics.kz/kz/comics/5/1" },
    { t: "–ï—Ä –¢–∞—Ä“ì—ã–Ω 2", url: "https://qazcomics.kz/kz/comics/5/2" },
    { t: "–ï—Ä –¢–∞—Ä“ì—ã–Ω 3", url: "https://qazcomics.kz/kz/comics/5/3" },
    { t: "–ï—Ä –¢–∞—Ä“ì—ã–Ω 4", url: "https://qazcomics.kz/kz/comics/5/4" },
  ];

  const WORDS = [
    { kk: "—Ç–∞“õ—ã—Ä—ã–ø", ru: "—Ç–µ–º–∞" },
    { kk: "–Ω–µ–≥—ñ–∑–≥—ñ –æ–π", ru: "–≥–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å" },
    { kk: "–º”ô—Ç—ñ–Ω", ru: "—Ç–µ–∫—Å—Ç" },
    { kk: "–∫–µ–π—ñ–ø–∫–µ—Ä", ru: "–ø–µ—Ä—Å–æ–Ω–∞–∂" },
    { kk: "–æ“õ–∏“ì–∞", ru: "—Å–æ–±—ã—Ç–∏–µ" },
    { kk: "–±–∞—Å—ã", ru: "–Ω–∞—á–∞–ª–æ" },
    { kk: "–Ω–µ–≥—ñ–∑–≥—ñ –±”©–ª—ñ–º", ru: "–æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å" },
    { kk: "—Å–æ“£—ã", ru: "–∫–æ–Ω–µ—Ü" },
  ];

  const LESSONS = [
    {
      id: "7_main_idea",
      grade: "7",
      topic: "–ú”ô—Ç—ñ–Ω",
      title: "–¢–∞“õ—ã—Ä—ã–ø –∂”ô–Ω–µ –Ω–µ–≥—ñ–∑–≥—ñ –æ–π",
      comic: { name: "–ï—Ä –¢–∞—Ä“ì—ã–Ω ‚Ä¢ 2", url: "https://qazcomics.kz/kz/comics/5/2" },
      lines: [
        { kk: "–¢–∞“õ—ã—Ä—ã–ø ‚Äî –º”ô—Ç—ñ–Ω –Ω–µ —Ç—É—Ä–∞–ª—ã –µ–∫–µ–Ω—ñ–Ω –∫”©—Ä—Å–µ—Ç–µ–¥—ñ.", ru: "–¢–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –æ —á—ë–º —Ç–µ–∫—Å—Ç." },
        { kk: "–ù–µ–≥—ñ–∑–≥—ñ –æ–π ‚Äî –∞–≤—Ç–æ—Ä –Ω–µ –∞–π—Ç“õ—ã—Å—ã –∫–µ–ª–µ–¥—ñ.", ru: "–ì–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å ‚Äî —á—Ç–æ —Ö–æ—Ç–µ–ª —Å–∫–∞–∑–∞—Ç—å –∞–≤—Ç–æ—Ä." },
        { kk: "–ù–µ–≥—ñ–∑–≥—ñ –æ–π–¥—ã –±—ñ—Ä —Å”©–π–ª–µ–º–º–µ–Ω –∞–π—Ç—É“ì–∞ –±–æ–ª–∞–¥—ã.", ru: "–ì–ª–∞–≤–Ω—É—é –º—ã—Å–ª—å –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º." },
      ],
      bank: ["–¢–∞“õ—ã—Ä—ã–ø", "–Ω–µ–≥—ñ–∑–≥—ñ", "–æ–π–¥—ã", "–∞–≤—Ç–æ—Ä", "–∞–π—Ç–∞–¥—ã"],
      quiz: [
        { q: "–ù–µ–≥—ñ–∑–≥—ñ –æ–π –¥–µ–≥–µ–Ω –Ω–µ?", opts: ["–ê–≤—Ç–æ—Ä–¥—ã“£ –∞–π—Ç“õ—ã—Å—ã –∫–µ–ª–≥–µ–Ω—ñ", "–ö–µ–π—ñ–ø–∫–µ—Ä–¥—ñ“£ –∞—Ç—ã"], ans: "–ê–≤—Ç–æ—Ä–¥—ã“£ –∞–π—Ç“õ—ã—Å—ã –∫–µ–ª–≥–µ–Ω—ñ" },
        { q: "–¢–∞“õ—ã—Ä—ã–ø –Ω–µ–Ω—ñ –∫”©—Ä—Å–µ—Ç–µ–¥—ñ?", opts: ["–ù–µ —Ç—É—Ä–∞–ª—ã", "“ö–∞–π –∂—ã–ª—ã"], ans: "–ù–µ —Ç—É—Ä–∞–ª—ã" },
      ],
      pickPool: [
        { q: "“ö–∞–π—Å—ã—Å—ã –Ω–µ–≥—ñ–∑–≥—ñ –æ–π?", opts: ["–ê–≤—Ç–æ—Ä–¥—ã“£ –∞–π—Ç“õ—ã—Å—ã –∫–µ–ª–≥–µ–Ω—ñ", "–ö–µ–π—ñ–ø–∫–µ—Ä–¥—ñ“£ –∞—Ç—ã", "“∞–∑—ã–Ω —Å”©–π–ª–µ–º"], ans: "–ê–≤—Ç–æ—Ä–¥—ã“£ –∞–π—Ç“õ—ã—Å—ã –∫–µ–ª–≥–µ–Ω—ñ" },
      ],
    },
    {
      id: "8_text_parts",
      grade: "8",
      topic: "–ú”ô—Ç—ñ–Ω",
      title: "–ú”ô—Ç—ñ–Ω –±”©–ª—ñ–∫—Ç–µ—Ä—ñ",
      comic: { name: "QazComics", url: "https://qazcomics.kz/kz" },
      lines: [
        { kk: "–ú”ô—Ç—ñ–Ω–Ω—ñ“£ –±–∞—Å—ã ‚Äî —Ç–∞–Ω—ã—Å—Ç—ã—Ä—É.", ru: "–ù–∞—á–∞–ª–æ ‚Äî –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ." },
        { kk: "–ù–µ–≥—ñ–∑–≥—ñ –±”©–ª—ñ–º ‚Äî –æ“õ–∏“ì–∞.", ru: "–û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å ‚Äî —Å–æ–±—ã—Ç–∏–µ." },
        { kk: "–°–æ“£—ã ‚Äî “õ–æ—Ä—ã—Ç—ã–Ω–¥—ã.", ru: "–ö–æ–Ω–µ—Ü ‚Äî –∏—Ç–æ–≥." },
      ],
      bank: ["–ú”ô—Ç—ñ–Ω–Ω—ñ“£", "–±–∞—Å—ã", "–Ω–µ–≥—ñ–∑–≥—ñ", "–±”©–ª—ñ–º", "—Å–æ“£—ã"],
      quiz: [
        { q: "–û“õ–∏“ì–∞ “õ–∞–π –±”©–ª—ñ–∫—Ç–µ?", opts: ["–ù–µ–≥—ñ–∑–≥—ñ –±”©–ª—ñ–º", "–ë–∞—Å—ã"], ans: "–ù–µ–≥—ñ–∑–≥—ñ –±”©–ª—ñ–º" },
        { q: "“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã “õ–∞–π–¥–∞?", opts: ["–°–æ“£—ã", "–ë–∞—Å—ã"], ans: "–°–æ“£—ã" },
      ],
      pickPool: [
        { q: "“ö–∞–π—Å—ã—Å—ã —Å–æ“£—ã?", opts: ["“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã", "–û“õ–∏“ì–∞", "–¢–∞–Ω—ã—Å—Ç—ã—Ä—É"], ans: "“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã" },
      ],
    },
  ];

  function showPage(name){
    $("#page-home").classList.toggle("is-on", name === "home");
    $("#page-lesson").classList.toggle("is-on", name === "lesson");
    $("#page-assistant").classList.toggle("is-on", name === "assistant");
    $("#navHome").classList.toggle("is-on", name === "home");
    $("#navAssistant").classList.toggle("is-on", name === "assistant");
  }

  function canSpeak(){
    return "speechSynthesis" in window && "SpeechSynthesisUtterance" in window;
  }
  function stopReading(){
    if (STATE.readTimer) { clearTimeout(STATE.readTimer); STATE.readTimer = null; }
    if (canSpeak()) window.speechSynthesis.cancel();
  }
  function speak(text){
    if (!STATE.sound) return;
    if (!canSpeak()) { $("#speechHint").textContent = "–û–∑–≤—É—á–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ."; return; }
    $("#speechHint").textContent = "";
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 0.95;
    window.speechSynthesis.speak(u);
  }

  function filteredLessons(){
    return STATE.grade === "all" ? LESSONS : LESSONS.filter(x => x.grade === STATE.grade);
  }

  function renderHome(){
    const grid = $("#topicGrid");
    grid.innerHTML = "";
    filteredLessons().forEach(l => {
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.innerHTML = `
        <div class="tMeta">
          <span class="chip">${l.grade}-—Å—ã–Ω—ã–ø</span>
          <span class="chip">${l.topic}</span>
        </div>
        <div class="tTitle">${l.title}</div>
        <div class="tSub">–ö–æ–º–∏–∫—Å ‚Ä¢ –¢“Ø—Å—ñ–Ω—É ‚Ä¢ –°”©–π–ª–µ–º “õ“±—Ä–∞</div>
      `;
      tile.addEventListener("click", () => openLesson(l.id));
      grid.appendChild(tile);
    });
  }

  function renderComics(){
    const box = $("#comicList");
    box.innerHTML = "";
    COMICS.forEach(c => {
      const r = document.createElement("div");
      r.className = "comRow";
      r.innerHTML = `<div class="comT">${c.t}</div><button class="btn ghost" type="button">–û—Ç–∫—Ä—ã—Ç—å</button>`;
      r.querySelector("button").addEventListener("click", () => window.open(c.url, "_blank", "noopener,noreferrer"));
      box.appendChild(r);
    });
  }

  function renderQuiz(items){
    const quiz = $("#quiz");
    quiz.innerHTML = "";
    items.forEach(it => {
      const row = document.createElement("div");
      row.className = "qrow";
      row.innerHTML = `<div class="qt">${it.q}</div><div class="pills"></div>`;
      const pills = row.querySelector(".pills");
      it.opts.forEach(opt => {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "pillbtn";
        b.textContent = opt;
        b.addEventListener("click", () => {
          if (opt === it.ans) { b.classList.add("ok"); speak("–ñ–∞—Ä–∞–π—Å—ã“£"); }
          else speak(it.ans);
        });
        pills.appendChild(b);
      });
      quiz.appendChild(row);
    });
  }

  function renderPick(pool){
    const pick = $("#pick");
    pick.innerHTML = "";
    const p = pool[Math.floor(Math.random()*pool.length)];
    [...p.opts].sort(() => Math.random() - 0.5).forEach(opt => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "abtn";
      b.textContent = opt;
      b.addEventListener("click", () => {
        if (opt === p.ans) { b.classList.add("ok"); speak("–ñ–∞—Ä–∞–π—Å—ã“£"); }
        else speak(p.ans);
      });
      pick.appendChild(b);
    });
  }

  function renderWords(){
    const q = ($("#wordSearch").value || "").trim().toLowerCase();
    const list = q ? WORDS.filter(w => w.kk.toLowerCase().includes(q) || w.ru.toLowerCase().includes(q)) : WORDS;
    const box = $("#words");
    box.innerHTML = "";
    list.forEach((w, i) => {
      const row = document.createElement("div");
      row.className = "wi";
      row.dataset.i = String(i);
      row.innerHTML = `
        <div>
          <div class="wkk">${w.kk}</div>
          <div class="wru">${w.ru}</div>
        </div>
        <button class="wiBtn" type="button">–û“õ—É</button>
      `;
      row.querySelector("button").addEventListener("click", () => speak(w.kk));
      box.appendChild(row);
    });
    return list;
  }

  function highlightWord(i){
    const rows = $$("#words .wi");
    rows.forEach(r => (r.style.outline = "none"));
    const t = rows[i];
    if (!t) return;
    t.style.outline = "3px solid rgba(59,130,246,.55)";
    t.style.outlineOffset = "2px";
    t.scrollIntoView({ block:"nearest", behavior:"smooth" });
  }

  function nextWord(){
    const list = renderWords();
    if (!list.length) return;
    if (STATE.wordIndex >= list.length) STATE.wordIndex = 0;
    highlightWord(STATE.wordIndex);
    speak(list[STATE.wordIndex].kk);
    STATE.wordIndex += 1;
  }

  function openLesson(id){
    const l = LESSONS.find(x => x.id === id) || LESSONS[0];
    STATE.lessonId = l.id;
    STATE.currentComic = l.comic.url;
    STATE.wordIndex = 0;
    stopReading();

    $("#chipGrade").textContent = l.grade + "-—Å—ã–Ω—ã–ø";
    $("#chipTopic").textContent = l.topic;
    $("#lessonTitle").textContent = l.title;
    $("#comicName").textContent = l.comic.name;

    const t = $("#lessonText");
    t.innerHTML = "";
    l.lines.forEach((ln, i) => {
      const row = document.createElement("div");
      row.className = "line";
      row.innerHTML = `
        <div class="badge">${i+1}</div>
        <div>
          <p class="k">${ln.kk}</p>
          <p class="r">${ln.ru}</p>
        </div>
      `;
      row.addEventListener("click", () => speak(ln.kk));
      t.appendChild(row);
    });

    const bank = $("#bank");
    bank.innerHTML = "";
    l.bank.forEach(w => {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "wbtn";
      b.textContent = w;
      b.addEventListener("click", () => {
        const out = $("#out");
        out.textContent = (out.textContent ? out.textContent + " " : "") + w;
        speak(w);
      });
      bank.appendChild(b);
    });
    $("#out").textContent = "";
    $("#wordSearch").value = "";

    renderComics();
    renderQuiz(l.quiz);
    renderPick(l.pickPool);
    renderWords();

    showPage("lesson");
  }

  function hook(){
    $("#navHome").addEventListener("click", () => showPage("home"));
    $("#navAssistant").addEventListener("click", () => showPage("assistant"));
    $("#goHome").addEventListener("click", () => showPage("home"));
    $("#backHome").addEventListener("click", () => showPage("home"));

    $$("[data-grade]").forEach(b => b.addEventListener("click", () => {
      STATE.grade = b.dataset.grade;
      $$("[data-grade]").forEach(x => x.classList.toggle("is-on", x.dataset.grade === STATE.grade));
      renderHome();
      showPage("home");
    }));

    $("#btnContrast").addEventListener("click", () => document.body.classList.toggle("contrast"));
    $("#btnFont").addEventListener("click", () => document.body.classList.toggle("big"));
    $("#btnSound").addEventListener("click", () => {
      STATE.sound = !STATE.sound;
      $("#btnSound").classList.toggle("is-on", STATE.sound);
      if (!STATE.sound) stopReading();
    });

    $("#btnOpenComic").addEventListener("click", () => window.open(STATE.currentComic, "_blank", "noopener,noreferrer"));
    $("#btnReadAll").addEventListener("click", () => {
      stopReading();
      const l = LESSONS.find(x => x.id === STATE.lessonId) || LESSONS[0];
      let i = 0;
      const seq = () => {
        if (!STATE.sound) return;
        if (i >= l.lines.length) return;
        speak(l.lines[i].kk);
        i += 1;
        STATE.readTimer = setTimeout(seq, 1200);
      };
      seq();
    });
    $("#btnStop").addEventListener("click", stopReading);

    $("#btnClearLine").addEventListener("click", () => $("#out").textContent = "");
    $("#btnSayLine").addEventListener("click", () => speak($("#out").textContent || " "));
    $("#btnPickNew").addEventListener("click", () => {
      const l = LESSONS.find(x => x.id === STATE.lessonId) || LESSONS[0];
      renderPick(l.pickPool);
    });

    $("#wordSearch").addEventListener("input", () => { STATE.wordIndex = 0; renderWords(); });
    $("#btnWordNext").addEventListener("click", nextWord);

    $("#btnPrev").addEventListener("click", () => {
      const list = filteredLessons();
      const idx = Math.max(0, list.findIndex(x => x.id === STATE.lessonId));
      openLesson(list[(idx - 1 + list.length) % list.length].id);
    });
    $("#btnNext").addEventListener("click", () => {
      const list = filteredLessons();
      const idx = Math.max(0, list.findIndex(x => x.id === STATE.lessonId));
      openLesson(list[(idx + 1) % list.length].id);
    });
  }

  // —Å—Ç–∞—Ä—Ç
  renderHome();
  hook();
  showPage("home");
</script>
</body>
</html>
